{"ast":null,"code":"var _jsxFileName = \"C:\\\\My\\\\Programesoft\\\\Javascript\\\\bookshop\\\\src\\\\screens\\\\Main\\\\components\\\\OfferBooks.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useContext, useEffect } from \"react\";\nimport fetcher from \"../../../functions/fetcher\";\nimport formater from \"../../../functions/formater\";\nimport topics from \"../topics\";\nimport BookCard from \"../../../globalComponents/BookCard\";\nimport compare from \"../../../functions/compare\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst OfferBooks = () => {\n  _s();\n\n  const [data, setData] = useState([]);\n\n  const random = (a, b) => {\n    return Math.floor(a + Math.random() * (b + 1 - a));\n  };\n\n  useEffect(() => {\n    const requestNumber = 6;\n    const previousTopics = JSON.parse(localStorage.getItem(\"previousTopics\"));\n    const randomTopics = [...topics];\n    randomTopics.sort(() => 0.5 - Math.random()); // let mass=[{title:\"Books from author you liked\",key:\"likedBookAuthors\"},{title:\"Books you were searching for\",key:\"prevBookTopics\"},{title:\"Books from categories you liked\",key:\"prevLikedBooks\"}].forEach(async ({title,key})=>{\n    // \tif (previousData[key].length==0) return;\n    // \trequestNumber--;\n    // \tlet requestData;\n    // \tif (random(0,1)==0) {\n    // \t\tpreviousData[key].sort(()=>0.5-Math.random());\n    // \t\trequestData=previousData[key][0];\n    // \t} else {\n    // \t\trequestData=previousData[key][previousData[key].length-1];\n    // \t}\n    // \trequest(requestData,title)\n    // })\n\n    for (let i = 0; i < requestNumber; i++) request(randomTopics[i], randomTopics[i]);\n  }, []);\n\n  const sort = items => {\n    if (random(0, 1) == 0) {\n      items.sort(() => 0.5 - Math.random());\n    } else {\n      const rightAnswer = \"/static/media/starFilled.2ebd54fe5113a74ba3cd.png\";\n\n      const count = _ref => {\n        let {\n          ratingStarsArray\n        } = _ref;\n        let result = 0;\n        ratingStarsArray.forEach(elem => {\n          if (elem == rightAnswer) result++;\n        });\n        return result;\n      };\n\n      items.sort((next, curr) => {\n        return count(curr) - count(next);\n      });\n    }\n  };\n\n  const filter = items => {\n    let mass = JSON.parse(localStorage.getItem(\"favoriteBooks\"));\n    return items.filter(elem => {\n      for (let i = 0; i < mass.length; i++) {\n        if (compare(mass[i], elem)) return false;\n      }\n\n      return true;\n    });\n  };\n\n  const request = async (mass, title) => {\n    try {\n      let response = await fetcher(mass);\n      let {\n        items\n      } = await response.json();\n      items = items.map(elem => formater(elem));\n      items = filter(items);\n      sort(items);\n      setData(curr => [...curr, {\n        title: title,\n        elements: items.slice(0, 6)\n      }]);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return data.map(_ref2 => {\n    let {\n      title,\n      elements\n    } = _ref2;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"title\",\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"main__line\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 4\n      }, this), elements.map(elem => /*#__PURE__*/_jsxDEV(BookCard, {\n        data: elem,\n        mode: \"normal\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 26\n      }, this))]\n    }, void 0, true);\n  });\n};\n\n_s(OfferBooks, \"FTfFkLfVdcj0Uk2EahF49AUIgmY=\");\n\n_c = OfferBooks;\nexport default OfferBooks;\nlocalStorage.setItem(\"previousTopics\", JSON.stringify([]));\n\nvar _c;\n\n$RefreshReg$(_c, \"OfferBooks\");","map":{"version":3,"sources":["C:/My/Programesoft/Javascript/bookshop/src/screens/Main/components/OfferBooks.js"],"names":["React","useState","useContext","useEffect","fetcher","formater","topics","BookCard","compare","OfferBooks","data","setData","random","a","b","Math","floor","requestNumber","previousTopics","JSON","parse","localStorage","getItem","randomTopics","sort","i","request","items","rightAnswer","count","ratingStarsArray","result","forEach","elem","next","curr","filter","mass","length","title","response","json","map","elements","slice","error","console","log","setItem","stringify"],"mappings":"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","sourcesContent":["import React,{useState,useContext,useEffect} from \"react\";\r\nimport fetcher from \"../../../functions/fetcher\";\r\nimport formater from \"../../../functions/formater\";\r\nimport topics from \"../topics\";\r\nimport BookCard from \"../../../globalComponents/BookCard\";\r\nimport compare from \"../../../functions/compare\";\r\nconst OfferBooks=()=>{\r\n\tconst [data,setData]=useState([]);\r\n\tconst random=(a,b)=> {\r\n\t\treturn Math.floor(a+Math.random()*(b+1-a));\r\n\t}\r\n\tuseEffect(()=>{\r\n\t\tconst requestNumber=6;\r\n\t\tconst previousTopics=JSON.parse(localStorage.getItem(\"previousTopics\"));\r\n\t\tconst randomTopics=[...topics];\r\n\t\trandomTopics.sort(()=>0.5-Math.random());\r\n\t\t// let mass=[{title:\"Books from author you liked\",key:\"likedBookAuthors\"},{title:\"Books you were searching for\",key:\"prevBookTopics\"},{title:\"Books from categories you liked\",key:\"prevLikedBooks\"}].forEach(async ({title,key})=>{\r\n\t\t// \tif (previousData[key].length==0) return;\r\n\t\t// \trequestNumber--;\r\n\t\t// \tlet requestData;\r\n\t\t// \tif (random(0,1)==0) {\r\n\t\t// \t\tpreviousData[key].sort(()=>0.5-Math.random());\r\n\t\t// \t\trequestData=previousData[key][0];\r\n\t\t// \t} else {\r\n\t\t// \t\trequestData=previousData[key][previousData[key].length-1];\r\n\t\t// \t}\r\n\t\t// \trequest(requestData,title)\r\n\t\t// })\r\n\t\tfor (let i=0;i<requestNumber;i++) request(randomTopics[i],randomTopics[i])\r\n\t},[]);\r\n\tconst sort=(items)=>{\r\n\t\tif (random(0,1)==0) {\r\n\t\t\titems.sort(()=>0.5-Math.random());\r\n\t\t} else {\r\n\t\t\tconst rightAnswer=\"/static/media/starFilled.2ebd54fe5113a74ba3cd.png\";\r\n\t\t\tconst count=({ratingStarsArray})=>{\r\n\t\t\t\tlet result=0;\r\n\t\t\t\tratingStarsArray.forEach((elem)=>{\r\n\t\t\t\t\tif (elem==rightAnswer) result++;\r\n\t\t\t\t});\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\titems.sort((next,curr)=>{\r\n\t\t\t\treturn count(curr)-count(next);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tconst filter=(items)=>{\r\n\t\tlet mass=JSON.parse(localStorage.getItem(\"favoriteBooks\"));\r\n\t\treturn items.filter((elem)=>{\r\n\t\t\tfor (let i=0;i<mass.length;i++) {\r\n\t\t\t\tif (compare(mass[i],elem)) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t})\r\n\t}\r\n\tconst request=async (mass,title)=> {\r\n\t\ttry {\r\n\t\t\tlet response=await fetcher(mass);\r\n\t\t\tlet {items}=await response.json();\r\n\t\t\titems=items.map((elem)=>formater(elem));\r\n\t\t\titems=filter(items);\r\n\t\t\tsort(items);\r\n\t\t\tsetData((curr)=>[...curr,{title:title,elements:items.slice(0,6)}]);\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t}\r\n\treturn (\r\n\t\tdata.map(({title,elements})=><>\r\n\t\t\t<p className=\"title\">{title}</p>\r\n\t\t\t<p className=\"main__line\"/>\r\n\t\t\t{elements.map((elem)=><BookCard data={elem} mode=\"normal\"/>)}\r\n\t\t</>)\r\n\t);\r\n};\r\nexport default OfferBooks;\r\nlocalStorage.setItem(\"previousTopics\",JSON.stringify([]))"]},"metadata":{},"sourceType":"module"}