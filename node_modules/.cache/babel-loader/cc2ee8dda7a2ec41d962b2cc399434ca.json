{"ast":null,"code":"var _jsxFileName = \"C:\\\\My\\\\Programesoft\\\\Javascript\\\\bookshop\\\\src\\\\screens\\\\Main\\\\components\\\\OfferBooks.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useContext, useEffect } from \"react\";\nimport fetcher from \"../../../functions/fetcher\";\nimport formater from \"../../../functions/formater\";\nimport topics from \"../topics\";\nimport BookCard from \"../../../globalComponents/BookCard\";\nimport compare from \"../../../functions/compare\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst OfferBooks = () => {\n  _s();\n\n  const [data, setData] = useState([]);\n\n  const random = (a, b) => {\n    return Math.floor(a + Math.random() * (b + 1 - a));\n  };\n\n  useEffect(() => {\n    const requestNumber = 6;\n    const previousData = JSON.parse(localStorage.getItem(\"searchInfo\"));\n    const randomTopics = [...topics];\n    randomTopics.sort(() => 0.5 - Math.random());\n    let mass = [{\n      title: \"Books from author you liked\",\n      key: \"likedBookAuthors\"\n    }, {\n      title: \"Books you were searching for\",\n      key: \"prevBookTopics\"\n    }, {\n      title: \"You may also like\",\n      key: \"prevLikedBooks\"\n    }].forEach(async _ref => {\n      let {\n        title,\n        key\n      } = _ref;\n      if (previousData[key].length == 0) return;\n      requestNumber--;\n      let requestData;\n\n      if (random(0, 1) == 0) {\n        previousData[key].sort(() => 0.5 - Math.random());\n        requestData = previousData[key][0];\n      } else {\n        requestData = previousData[key][previousData[key].length - 1];\n      }\n\n      request(requestData, title);\n    });\n\n    for (let i = 0; i < requestNumber; i++) request(randomTopics[i], randomTopics[i]);\n  }, []);\n\n  const sort = items => {\n    if (random(0, 1) == 0) {\n      items.sort(() => 0.5 - Math.random());\n    } else {\n      const rightAnswer = \"/static/media/starFilled.2ebd54fe5113a74ba3cd.png\";\n\n      const count = _ref2 => {\n        let {\n          ratingStarsArray\n        } = _ref2;\n        let result = 0;\n        ratingStarsArray.forEach(elem => {\n          if (elem == rightAnswer) result++;\n        });\n        return result;\n      };\n\n      items.sort((next, curr) => {\n        return count(curr) - count(next);\n      });\n    }\n  };\n\n  const filter = items => {\n    let mass = JSON.parse(localStorage.getItem(\"favoriteBooks\"));\n    return items.filter(elem => {\n      for (let i = 0; i < mass.length; i++) {\n        if (compare(mass[i], elem)) return false;\n      }\n\n      return true;\n    });\n  };\n\n  const request = async (mass, title) => {\n    try {\n      let response = await fetcher(mass);\n      let {\n        items\n      } = await response.json();\n      items = items.map(elem => formater(elem));\n      sort(items);\n      items = filter(items);\n      setData(curr => [...curr, {\n        title: title,\n        elements: items.slice(0, 6)\n      }]);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return data.map(_ref3 => {\n    let {\n      title,\n      elements\n    } = _ref3;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"title\",\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"main__line\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 4\n      }, this), elements.map(elem => /*#__PURE__*/_jsxDEV(BookCard, {\n        data: elem,\n        mode: \"normal\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 26\n      }, this))]\n    }, void 0, true);\n  });\n};\n\n_s(OfferBooks, \"FTfFkLfVdcj0Uk2EahF49AUIgmY=\");\n\n_c = OfferBooks;\nexport default OfferBooks;\n\nvar _c;\n\n$RefreshReg$(_c, \"OfferBooks\");","map":{"version":3,"sources":["C:/My/Programesoft/Javascript/bookshop/src/screens/Main/components/OfferBooks.js"],"names":["React","useState","useContext","useEffect","fetcher","formater","topics","BookCard","compare","OfferBooks","data","setData","random","a","b","Math","floor","requestNumber","previousData","JSON","parse","localStorage","getItem","randomTopics","sort","mass","title","key","forEach","length","requestData","request","i","items","rightAnswer","count","ratingStarsArray","result","elem","next","curr","filter","response","json","map","elements","slice","error","console","log"],"mappings":"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","sourcesContent":["import React,{useState,useContext,useEffect} from \"react\";\r\nimport fetcher from \"../../../functions/fetcher\";\r\nimport formater from \"../../../functions/formater\";\r\nimport topics from \"../topics\";\r\nimport BookCard from \"../../../globalComponents/BookCard\";\r\nimport compare from \"../../../functions/compare\";\r\nconst OfferBooks=()=>{\r\n\tconst [data,setData]=useState([]);\r\n\tconst random=(a,b)=> {\r\n\t\treturn Math.floor(a+Math.random()*(b+1-a));\r\n\t}\r\n\tuseEffect(()=>{\r\n\t\tconst requestNumber=6;\r\n\t\tconst previousData=JSON.parse(localStorage.getItem(\"searchInfo\"));\r\n\t\tconst randomTopics=[...topics];\r\n\t\trandomTopics.sort(()=>0.5-Math.random());\r\n\r\n\t\tlet mass=[{title:\"Books from author you liked\",key:\"likedBookAuthors\"},{title:\"Books you were searching for\",key:\"prevBookTopics\"},{title:\"You may also like\",key:\"prevLikedBooks\"}].forEach(async ({title,key})=>{\r\n\t\t\tif (previousData[key].length==0) return;\r\n\t\t\trequestNumber--;\r\n\t\t\tlet requestData;\r\n\t\t\tif (random(0,1)==0) {\r\n\t\t\t\tpreviousData[key].sort(()=>0.5-Math.random());\r\n\t\t\t\trequestData=previousData[key][0];\r\n\t\t\t} else {\r\n\t\t\t\trequestData=previousData[key][previousData[key].length-1];\r\n\t\t\t}\r\n\t\t\trequest(requestData,title)\r\n\t\t})\r\n\t\tfor (let i=0;i<requestNumber;i++) request(randomTopics[i],randomTopics[i])\r\n\r\n\t},[]);\r\n\tconst sort=(items)=>{\r\n\t\tif (random(0,1)==0) {\r\n\t\t\titems.sort(()=>0.5-Math.random());\r\n\t\t} else {\r\n\t\t\tconst rightAnswer=\"/static/media/starFilled.2ebd54fe5113a74ba3cd.png\";\r\n\t\t\tconst count=({ratingStarsArray})=>{\r\n\t\t\t\tlet result=0;\r\n\t\t\t\tratingStarsArray.forEach((elem)=>{\r\n\t\t\t\t\tif (elem==rightAnswer) result++;\r\n\t\t\t\t});\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\titems.sort((next,curr)=>{\r\n\t\t\t\treturn count(curr)-count(next);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tconst filter=(items)=>{\r\n\t\tlet mass=JSON.parse(localStorage.getItem(\"favoriteBooks\"));\r\n\t\treturn items.filter((elem)=>{\r\n\t\t\tfor (let i=0;i<mass.length;i++) {\r\n\t\t\t\tif (compare(mass[i],elem)) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t})\r\n\t}\r\n\tconst request=async (mass,title)=> {\r\n\t\ttry {\r\n\t\t\tlet response=await fetcher(mass);\r\n\t\t\tlet {items}=await response.json();\r\n\t\t\titems=items.map((elem)=>formater(elem));\r\n\t\t\tsort(items);\r\n\t\t\titems=filter(items);\r\n\t\t\tsetData((curr)=>[...curr,{title:title,elements:items.slice(0,6)}]);\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\tdata.map(({title,elements})=><>\r\n\t\t\t<p className=\"title\">{title}</p>\r\n\t\t\t<p className=\"main__line\"/>\r\n\t\t\t{elements.map((elem)=><BookCard data={elem} mode=\"normal\"/>)}\r\n\t\t</>)\r\n\t);\r\n};\r\nexport default OfferBooks;"]},"metadata":{},"sourceType":"module"}