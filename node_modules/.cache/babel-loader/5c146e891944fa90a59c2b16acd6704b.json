{"ast":null,"code":"var _jsxFileName = \"C:\\\\My\\\\Programesoft\\\\Javascript\\\\bookshop\\\\src\\\\screens\\\\Main\\\\components\\\\OfferBooks.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useContext, useEffect } from \"react\";\nimport fetcher from \"../../../functions/fetcher\";\nimport formater from \"../../../functions/formater\";\nimport topics from \"../topics\";\nimport BookCard from \"../../../globalComponents/BookCard\";\nimport compare from \"../../../functions/compare\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst OfferBooks = () => {\n  _s();\n\n  const [data, setData] = useState([]);\n\n  const random = (a, b) => {\n    return Math.floor(a + Math.random() * (b + 1 - a));\n  };\n\n  useEffect(() => {\n    const requestNumber = 6;\n    const randomTopics = [...topics];\n    randomTopics.sort(() => 0.5 - Math.random());\n    let mass = [{\n      title: \"Books from author you liked\",\n      data: getElementsByKey(\"authors\")\n    }, {\n      title: \"Books you were searching for\",\n      data: JSON.parse(localStorage.getItem(\"previousTopics\"))\n    }, {\n      title: \"Books from categories you liked\",\n      data: []\n    }].forEach(async _ref => {\n      let {\n        title,\n        data\n      } = _ref;\n      if (data.length == 0) return;\n      requestNumber--;\n      let requestData;\n\n      if (random(0, 1) == 0) {\n        data.sort(() => 0.5 - Math.random());\n        requestData = data[0];\n      } else {\n        requestData = data[data.length - 1];\n      }\n\n      request(requestData, title);\n    });\n\n    for (let i = 0; i < requestNumber; i++) request(randomTopics[i], randomTopics[i]);\n  }, []);\n\n  const sort = items => {\n    if (random(0, 1) == 0) {\n      items.sort(() => 0.5 - Math.random());\n    } else {\n      const rightAnswer = \"/static/media/starFilled.2ebd54fe5113a74ba3cd.png\";\n\n      const count = _ref2 => {\n        let {\n          ratingStarsArray\n        } = _ref2;\n        let result = 0;\n        ratingStarsArray.forEach(elem => {\n          if (elem == rightAnswer) result++;\n        });\n        return result;\n      };\n\n      items.sort((next, curr) => {\n        return count(curr) - count(next);\n      });\n    }\n  };\n\n  const filter = items => {\n    let mass = JSON.parse(localStorage.getItem(\"favoriteBooks\"));\n    return items.filter(elem => {\n      for (let i = 0; i < mass.length; i++) {\n        if (compare(mass[i], elem)) return false;\n      }\n\n      return true;\n    });\n  };\n\n  const request = async (mass, title) => {\n    try {\n      let response = await fetcher(mass);\n      let {\n        items\n      } = await response.json();\n      items = items.map(elem => formater(elem));\n      items = filter(items);\n      sort(items);\n      setData(curr => [...curr, {\n        title: title,\n        elements: items.slice(0, 6)\n      }]);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const getElementsByKey = key => {\n    const mass = JSON.parse(localStorage);\n  };\n\n  return data.map(_ref3 => {\n    let {\n      title,\n      elements\n    } = _ref3;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"title\",\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"main__line\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 7\n      }, this), elements.map(elem => /*#__PURE__*/_jsxDEV(BookCard, {\n        data: elem,\n        mode: \"normal\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this))]\n    }, void 0, true);\n  });\n};\n\n_s(OfferBooks, \"IEMTtLVFIuToo7X/raQbJAxzNQU=\");\n\n_c = OfferBooks;\nexport default OfferBooks;\n\nvar _c;\n\n$RefreshReg$(_c, \"OfferBooks\");","map":{"version":3,"sources":["C:/My/Programesoft/Javascript/bookshop/src/screens/Main/components/OfferBooks.js"],"names":["React","useState","useContext","useEffect","fetcher","formater","topics","BookCard","compare","OfferBooks","data","setData","random","a","b","Math","floor","requestNumber","randomTopics","sort","mass","title","getElementsByKey","JSON","parse","localStorage","getItem","forEach","length","requestData","request","i","items","rightAnswer","count","ratingStarsArray","result","elem","next","curr","filter","response","json","map","elements","slice","error","console","log","key"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from \"react\";\r\nimport fetcher from \"../../../functions/fetcher\";\r\nimport formater from \"../../../functions/formater\";\r\nimport topics from \"../topics\";\r\nimport BookCard from \"../../../globalComponents/BookCard\";\r\nimport compare from \"../../../functions/compare\";\r\nconst OfferBooks = () => {\r\n  const [data, setData] = useState([]);\r\n  const random = (a, b) => {\r\n    return Math.floor(a + Math.random() * (b + 1 - a));\r\n  };\r\n  useEffect(() => {\r\n    const requestNumber = 6;\r\n    const randomTopics = [...topics];\r\n\t\trandomTopics.sort(() => 0.5 - Math.random());\r\n    let mass = [\r\n      { title: \"Books from author you liked\",data:getElementsByKey(\"authors\") },\r\n      { title: \"Books you were searching for\", data:JSON.parse(localStorage.getItem(\"previousTopics\")) },\r\n      { title: \"Books from categories you liked\", data:[] }\r\n    ].forEach(async ({ title,data }) => {\r\n      if (data.length == 0) return;\r\n      requestNumber--;\r\n      let requestData;\r\n      if (random(0, 1) == 0) {\r\n        data.sort(() => 0.5 - Math.random());\r\n        requestData = data[0];\r\n      } else {\r\n        requestData = data[data.length - 1];\r\n      }\r\n      request(requestData, title);\r\n    });\r\n    for (let i = 0; i < requestNumber; i++)\r\n      request(randomTopics[i], randomTopics[i]);\r\n  }, []);\r\n  const sort = (items) => {\r\n    if (random(0, 1) == 0) {\r\n      items.sort(() => 0.5 - Math.random());\r\n    } else {\r\n      const rightAnswer = \"/static/media/starFilled.2ebd54fe5113a74ba3cd.png\";\r\n      const count = ({ ratingStarsArray }) => {\r\n        let result = 0;\r\n        ratingStarsArray.forEach((elem) => {\r\n          if (elem == rightAnswer) result++;\r\n        });\r\n        return result;\r\n      };\r\n      items.sort((next, curr) => {\r\n        return count(curr) - count(next);\r\n      });\r\n    }\r\n  };\r\n  const filter = (items) => {\r\n    let mass = JSON.parse(localStorage.getItem(\"favoriteBooks\"));\r\n    return items.filter((elem) => {\r\n      for (let i = 0; i < mass.length; i++) {\r\n        if (compare(mass[i], elem)) return false;\r\n      }\r\n      return true;\r\n    });\r\n  };\r\n  const request = async (mass, title) => {\r\n    try {\r\n      let response = await fetcher(mass);\r\n      let { items } = await response.json();\r\n      items = items.map((elem) => formater(elem));\r\n      items = filter(items);\r\n      sort(items);\r\n      setData((curr) => [\r\n        ...curr,\r\n        { title: title, elements: items.slice(0, 6) },\r\n      ]);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n\t};\r\n\tconst getElementsByKey=(key)=>{\r\n\t\tconst mass=JSON.parse(localStorage)\r\n\t}\r\n  return data.map(({ title, elements }) => (\r\n    <>\r\n      <p className=\"title\">{title}</p>\r\n      <p className=\"main__line\" />\r\n      {elements.map((elem) => (\r\n        <BookCard data={elem} mode=\"normal\" />\r\n      ))}\r\n    </>\r\n  ));\r\n};\r\nexport default OfferBooks;\r\n"]},"metadata":{},"sourceType":"module"}